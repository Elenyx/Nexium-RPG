# ==============================================================================
# NEXIUM RPG - API FORWARDING WITH PHP
# ==============================================================================
# This version uses a PHP script to forward API requests to Node.js rather than
# relying on Apache's mod_proxy which might not be available on shared hosting.
# ==============================================================================

# Enable the rewrite engine for all rules
RewriteEngine On

# ------------------------------------------------------------------------------
# SECTION 1: FORWARD API REQUESTS TO PHP PROXY
# ------------------------------------------------------------------------------
# Routes requests to auth-proxy.php which will handle forwarding to Node.js

# Auth routes
RewriteRule ^auth/(.*)$ auth-proxy.php [L,QSA]

# Other API endpoints
RewriteRule ^(me|leaderboards|rewards|logout)$ auth-proxy.php [L,QSA]

# ------------------------------------------------------------------------------
# SECTION 2: SERVE EXISTING STATIC FILES
# ------------------------------------------------------------------------------
# This section ensures that requests for actual files are served directly

# If the request is for an existing file...
RewriteCond %{REQUEST_FILENAME} -f [OR]
# ...or an existing directory...
RewriteCond %{REQUEST_FILENAME} -d
# ...then stop processing and serve the file/directory directly.
RewriteRule ^ - [L]

# ------------------------------------------------------------------------------
# SECTION 3: FALLBACK FOR CLIENT-SIDE ROUTING
# ------------------------------------------------------------------------------
# For single-page application support - serve index.html for unmatched routes
RewriteRule ^ index.html [L]

# Add content type for .htaccess if a debug request is made
<Files .htaccess>
    ForceType text/plain
</Files>
